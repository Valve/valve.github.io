
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>JSON serialization in Rust, part 2 - valve's</title>
  <meta name="author" content="valve">

  
  <meta name="description" content="This post is intended for people coming from high level languages, such as
Ruby or JavaScript and who may be surprised with the complexity of
the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://valve.github.io/blog/2014/08/26/json-serialization-in-rust-part-2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="valve's" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-42202458-1', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">valve's</a></h1>
  
    <h2>corner</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:valve.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">JSON Serialization in Rust, Part 2</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-26T09:09:00+04:00" pubdate data-updated="true">Aug 26<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>This post is intended for people coming from high level languages, such as
Ruby or JavaScript and who may be surprised with the complexity of
the JSON serialization infrastructure in Rust.</p>

<p>This is the second part of the 2 part post that deals with decoding JSON
strings into Rust values.
<a href="http://valve.github.io/blog/2014/08/25/json-serialization-in-rust-part-1/">First part is available here</a>.</p>

<h2>Overview</h2>

<p>When working with JSON deserialization, we&rsquo;re interested in
<a href="http://doc.rust-lang.org/serialize/trait.Decodable.html">Decodable</a> and
<a href="http://doc.rust-lang.org/serialize/trait.Decoder.html">Decoder</a> traits.</p>

<p>As with serialization, <code>hex</code> and <code>base64</code> modules are not relevant to JSON
deserialization, so we should not pay attention to them.</p>

<!--more -->


<h2>Deserialization</h2>

<p>In order for a type to be decodable from JSON, it must implement
<a href="http://doc.rust-lang.org/serialize/trait.Decodable.html">Decodable</a>
trait. Almost all built-in types already implement it, so you can deserialize
them with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="n">extern</span> <span class="n">crate</span> <span class="n">serialize</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">serialize</span><span class="o">::</span><span class="p">{</span><span class="n">json</span><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">fn</span> <span class="n">main</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">numeric_s</span> <span class="o">=</span> <span class="s">&quot;3.14&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">greeting</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">Hello, world</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">pi</span><span class="o">:</span> <span class="k">f64</span> <span class="o">=</span> <span class="n">json</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">numeric_s</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span class='line'>  <span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">pi</span><span class="p">);</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">decoded_greeting</span><span class="o">:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">json</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">greeting</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span class='line'>  <span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">decoded_greeting</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// 3.14</span>
</span><span class='line'><span class="c1">// Hello, world</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://is.gd/N3p1IE">playpen</a></p>

<h3>Option</h3>

<p>Deserializing to Option is somewhat redundant, because <code>json::decode</code>
<a href="https://github.com/rust-lang/rust/blob/5fb2dfaa200f2cb32e77c54ae8a5e0f4823b65c8/src/libserialize/json.rs#L288">returns</a>
<a href="http://doc.rust-lang.org/serialize/json/type.DecodeResult.html">DecodeResult</a>, which is a type alias
for a regular result. That means you can pattern match on DecodeResult
and handle potential failure.</p>

<h3>Vector</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="c1">// assuming in main with json in scope</span>
</span><span class='line'><span class="k">let</span> <span class="n">raw_json</span> <span class="o">=</span> <span class="s">&quot;[42, 43, 44, 45]&quot;</span><span class="p">;</span>
</span><span class='line'><span class="k">let</span> <span class="n">vec</span><span class="o">:</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="k">i32</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">json</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">raw_json</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span class='line'><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">vec</span><span class="p">);</span>
</span><span class='line'><span class="c1">// [42, 43, 44, 56]</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://is.gd/z5cLqu">playpen</a></p>

<h3>Tuple</h3>

<p>Decoding JSON to a tuple is identical to vector, just specify the
correct type:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="c1">// assuming in main with json in scope</span>
</span><span class='line'><span class="k">let</span> <span class="n">raw_json</span> <span class="o">=</span> <span class="s">&quot;[42, 43]&quot;</span><span class="p">;</span>
</span><span class='line'><span class="k">let</span> <span class="n">tup</span><span class="o">:</span> <span class="p">(</span><span class="k">i32</span><span class="p">,</span> <span class="k">i32</span><span class="p">)</span> <span class="o">=</span> <span class="n">json</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">raw_json</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span class='line'><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">tup</span><span class="p">);</span>
</span><span class='line'><span class="c1">// (42, 43)</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://is.gd/KTvqSC">playpen</a></p>

<h3>HashMap</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="n">extern</span> <span class="n">crate</span> <span class="n">serialize</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">serialize</span><span class="o">::</span><span class="p">{</span><span class="n">json</span><span class="p">};</span>
</span><span class='line'><span class="k">use</span> <span class="n">std</span><span class="o">::</span><span class="n">collections</span><span class="o">::</span><span class="n">HashMap</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">fn</span> <span class="n">main</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">raw_json</span> <span class="o">=</span> <span class="s">&quot;{</span><span class="se">\&quot;</span><span class="s">e</span><span class="se">\&quot;</span><span class="s">:2.71,</span><span class="se">\&quot;</span><span class="s">pi</span><span class="se">\&quot;</span><span class="s">:3.14}&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">map</span><span class="o">:</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="k">f64</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">json</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">raw_json</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span class='line'>  <span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">map</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// {pi: 3.14, e: 2.71}</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://is.gd/f2Smhd">playpen</a></p>

<h3>Array</h3>

<p>As with serializing, Rust cannot automatically deserialize JSON string
into a fixed-length array. The reason for this is the same: arrays&#8217; type
signature contain length as part of the type, but Rust currently (and
most likely not until after v1.0) can&rsquo;t be generic over array&rsquo;s length.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="k">let</span> <span class="n">raw_json</span> <span class="o">=</span> <span class="s">&quot;[42, 43]&quot;</span><span class="p">;</span>
</span><span class='line'><span class="k">let</span> <span class="n">arr</span><span class="o">:</span> <span class="p">[</span><span class="k">i32</span><span class="p">,..</span><span class="m">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">raw_json</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span class='line'><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">arr</span><span class="p">);</span>
</span><span class='line'><span class="c1">// failed to find an implementation of trait</span>
</span><span class='line'><span class="c1">// serialize::serialize::Decodable&lt;serialize::json::Decoder,serialize::json::DecoderError&gt; </span>
</span><span class='line'><span class="c1">// for [i32, .. 2]</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://is.gd/c8N3CV">playpen</a></p>

<p>To remedy this, we will use custom decoding, as we did with custom array
encoding in part 1.
I&rsquo;ll show an example of this below.</p>

<h3>Structs</h3>

<p>As with serialization, it&rsquo;s possible to have Rust deserialize structs
automatically for you. You will need to add the
<code>#[deriving(Decodable)]</code> attribute to your struct:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="n">extern</span> <span class="n">crate</span> <span class="n">serialize</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">serialize</span><span class="o">::</span><span class="p">{</span><span class="n">json</span><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">fn</span> <span class="n">main</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">raw_json</span> <span class="o">=</span> <span class="s">&quot;{</span><span class="se">\&quot;</span><span class="s">name</span><span class="se">\&quot;</span><span class="s">:</span><span class="se">\&quot;</span><span class="s">John Doe</span><span class="se">\&quot;</span><span class="s">,</span><span class="se">\&quot;</span><span class="s">age</span><span class="se">\&quot;</span><span class="s">:33}&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">person</span><span class="o">:</span> <span class="n">Person</span> <span class="o">=</span> <span class="n">json</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">raw_json</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span class='line'>  <span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">person</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#[deriving(Encodable, Decodable, Show)]</span>
</span><span class='line'><span class="n">struct</span> <span class="n">Person</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">name</span><span class="o">:</span> <span class="n">String</span><span class="p">,</span>
</span><span class='line'>  <span class="n">age</span><span class="o">:</span> <span class="k">int</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// Person { name: John Doe, age: 33 }</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://is.gd/SdeDWO">playpen</a></p>

<p>Note that I&rsquo;m using 3 deriving trait implementations for a struct:
<code>Encodable</code>, <code>Decodable</code> and <code>Show</code>. This is to make my struct fully
JSON (de)serializable and printable automatically.</p>

<h3>Custom deserialization</h3>

<p>This is probably the cornerstone of the JSON infrastructure.
In real life you often cannot control the shape of the JSON that comes to
you, so you must be able to convert arbitrary JSON strings into your
objects. Luckily, Rust decoding capabilities will help us here.</p>

<p>Let us continue with our <code>Person</code> struct example and deserialize the
object from a complex JSON where our object is in the <code>data</code>
key. The example might be contrived, but it serves the demo purpose.</p>

<p>To make a type JSON deserializable we need to implement the <code>Decodable</code>
trait.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="n">extern</span> <span class="n">crate</span> <span class="n">serialize</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">serialize</span><span class="o">::</span><span class="p">{</span><span class="n">json</span><span class="p">,</span> <span class="n">Decodable</span><span class="p">,</span> <span class="n">Decoder</span><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="k">fn</span> <span class="n">main</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">raw_json</span> <span class="o">=</span> <span class="n">r</span><span class="err">#</span><span class="s">&quot;{&quot;</span><span class="k">type</span><span class="s">&quot;: &quot;</span><span class="n">Person</span><span class="s">&quot;, &quot;</span><span class="n">data</span><span class="s">&quot;: {&quot;</span><span class="n">name</span><span class="s">&quot;: &quot;</span><span class="n">John</span> <span class="n">Doe</span><span class="s">&quot;, &quot;</span><span class="n">age</span><span class="s">&quot;: 33}}&quot;</span><span class="err">#</span><span class="p">;</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">person</span><span class="o">:</span> <span class="n">Person</span> <span class="o">=</span> <span class="n">json</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">raw_json</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span class='line'>  <span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">person</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#[deriving(Show)]</span>
</span><span class='line'><span class="n">struct</span> <span class="n">Person</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">name</span><span class="o">:</span> <span class="n">String</span><span class="p">,</span>
</span><span class='line'>  <span class="n">age</span><span class="o">:</span> <span class="k">int</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">impl</span><span class="o">&lt;</span><span class="n">S</span><span class="o">:</span> <span class="n">Decoder</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">E</span><span class="o">&gt;</span> <span class="n">Decodable</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Person</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">fn</span> <span class="n">decode</span><span class="p">(</span><span class="n">decoder</span><span class="o">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">S</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Person</span><span class="p">,</span> <span class="n">E</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">decoder</span><span class="p">.</span><span class="n">read_struct</span><span class="p">(</span><span class="s">&quot;root&quot;</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="o">|</span><span class="n">decoder</span><span class="o">|</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">decoder</span><span class="p">.</span><span class="n">read_struct_field</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="o">|</span><span class="n">decoder</span><span class="o">|</span> <span class="p">{</span>
</span><span class='line'>         <span class="n">Ok</span><span class="p">(</span><span class="n">Person</span><span class="p">{</span>
</span><span class='line'>          <span class="n">name</span><span class="o">:</span> <span class="n">try</span><span class="o">!</span><span class="p">(</span><span class="n">decoder</span><span class="p">.</span><span class="n">read_struct_field</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="o">|</span><span class="n">decoder</span><span class="o">|</span> <span class="n">Decodable</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">decoder</span><span class="p">))),</span>
</span><span class='line'>          <span class="n">age</span><span class="o">:</span> <span class="n">try</span><span class="o">!</span><span class="p">(</span><span class="n">decoder</span><span class="p">.</span><span class="n">read_struct_field</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="o">|</span><span class="n">decoder</span><span class="o">|</span> <span class="n">Decodable</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">decoder</span><span class="p">)))</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>      <span class="p">})</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// Person { name: John Doe, age: 33 }</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://is.gd/TKPROs">playpen</a></p>

<p>Let&rsquo;s break down the code line by line to see what&rsquo;s going on here.</p>

<p><code>Line 2:</code> We need to bring both <code>Decodable</code> and <code>Decoder</code> traits into
scope. <code>Decodable</code> trait is for the struct to implement, to conform to
the JSON deserialization interface, while the
<code>Decoder</code> is the low level workhorse of deserialization, which tokenizes
and parses the JSON string to convert it to Rust values later.</p>

<p><code>Line 5:</code> I&rsquo;m using a raw string literal to avoid escaping double quotes.</p>

<p><code>Line 6:</code> The line where I&rsquo;m decoding JSON string into an instance of
<code>Person</code> struct. Note that I need to type-annotate the variable when
decoding it.</p>

<p><code>Line 10:</code> We no longer need to use the <code>#[deriving(Decodable)]</code>
attribute, because we implement the <code>Decodable</code> trait ourselves.</p>

<p><code>Line 16:</code> This is the <code>Decodable</code> implementation. It is very similar to
the <code>Encodable</code> implementation from part 1 with the exception of <code>S</code> being
type restricted to <code>Decoder</code> trait now.</p>

<p><code>Line 17:</code> Two differences from <code>encode</code> method counterpart:
we&rsquo;re no longer accepting <code>&amp;self</code> as the first argument,
because <code>decode</code> is an associated function, rather than a method.
The analogy is class methods in Ruby or static methods
in Java. Second difference is the return type. It is now <code>Result&lt;Person,
E&gt;</code>.</p>

<p><code>Line 18:</code> This is where the parsing starts. We do actual parsing with
<code>read_*</code> family of methods on <code>Decoder</code> instance. Here we&rsquo;re reading the
top-level struct with <code>read_struct</code> method. First argument is the name
of the sturct(not used), second is the length (not applicable). The third argument is an
instance of anonymous function (lambda). Why are the first and the
second arguments not used?
I think this is because the entire family of <code>read_*</code> methods of
<code>Encoder</code> strives to be uniform and thus a unified set of arguments
is used, even when the encoder does not need them.</p>

<p>You can think of the <code>read_struct</code> call as &ldquo;opening&rdquo; the top-level JSON
object to be able to move inside to read actual values. The lambda is
where we descend and continue with reading.</p>

<p><code>Line 19:</code> The object we&rsquo;re trying to read is in the <code>data</code> field, so
we&rsquo;re reading it on this line with <code>read_struct_field</code> method.
This time the first argument is necessary, because it tells the decoder
the actual name of the field. 3rd argument is the lambda again to
descend further into the the object in the <code>data</code> field.</p>

<p><code>Lines 20-21:</code> Field reading happens here. By this time the parser
has reached the contents of the <code>data</code> object so we can now just read the
fields we&rsquo;re interested in one-by-one. We&rsquo;re using <code>read_struct_field</code>
again, passing it the name of the field and the index(not used).
The third argument is the value of the field, correctly decoded from
JSON representation. Since all primitive values in Rust already
implement the <code>Decodable</code> trait, we can safely call <code>Decodable::decode</code>
on them to deserialize them as the <code>Person</code> struct fields.</p>

<h4>Deserializing fixed length arrays</h4>

<p>As in part 1, let&rsquo;s use this knowledge to deserialize a fixed-length
array from JSON.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="n">extern</span> <span class="n">crate</span> <span class="n">serialize</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">std</span><span class="o">::</span><span class="n">default</span><span class="o">::</span><span class="n">Default</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">serialize</span><span class="o">::</span><span class="p">{</span><span class="n">json</span><span class="p">,</span> <span class="n">Decodable</span><span class="p">,</span> <span class="n">Decoder</span><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="n">static</span> <span class="n">BUFFER_SIZE</span><span class="o">:</span> <span class="k">uint</span> <span class="o">=</span> <span class="m">4</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">fn</span> <span class="n">main</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">raw_json</span> <span class="o">=</span> <span class="s">&quot;[42, 43, 44, 45]&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">buf</span><span class="o">:</span> <span class="n">Buffer</span><span class="o">&lt;</span><span class="k">i32</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">json</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">raw_json</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>
</span><span class='line'>  <span class="k">let</span> <span class="n">Buffer</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="n">arr</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">struct</span> <span class="n">Buffer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">([</span><span class="n">T</span><span class="p">,..</span><span class="n">BUFFER_SIZE</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="k">impl</span><span class="o">&lt;</span><span class="n">S</span><span class="o">:</span> <span class="n">Decoder</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">T</span><span class="o">:</span> <span class="n">Default</span><span class="o">+</span><span class="n">Copy</span><span class="o">+</span><span class="n">Decodable</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">E</span><span class="o">&gt;</span> <span class="n">Decodable</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">E</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Buffer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">fn</span> <span class="n">decode</span><span class="p">(</span><span class="n">decoder</span><span class="o">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">S</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">Buffer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">E</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">decoder</span><span class="p">.</span><span class="n">read_seq</span><span class="p">(</span><span class="o">|</span><span class="n">decoder</span><span class="p">,</span> <span class="n">len</span><span class="o">|</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">len</span> <span class="o">!=</span> <span class="n">BUFFER_SIZE</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">return</span> <span class="n">Err</span><span class="p">(</span><span class="n">decoder</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&quot;Expecting array of length: {}, but found {}&quot;</span><span class="p">,</span> <span class="n">BUFFER_SIZE</span><span class="p">,</span> <span class="n">len</span><span class="p">).</span><span class="n">as_slice</span><span class="p">()));</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">let</span> <span class="k">mut</span> <span class="n">arr</span><span class="o">:</span> <span class="p">[</span><span class="n">T</span><span class="p">,..</span><span class="n">BUFFER_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Default</span><span class="o">::</span><span class="n">default</span><span class="p">(),..</span><span class="n">BUFFER_SIZE</span><span class="p">];</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="n">in</span> <span class="n">arr</span><span class="p">.</span><span class="n">mut_iter</span><span class="p">().</span><span class="n">enumerate</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="n">try</span><span class="o">!</span><span class="p">(</span><span class="n">decoder</span><span class="p">.</span><span class="n">read_seq_elt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Decodable</span><span class="o">::</span><span class="n">decode</span><span class="p">));</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">Ok</span><span class="p">(</span><span class="n">Buffer</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">// 42</span>
</span><span class='line'><span class="c1">// 43</span>
</span><span class='line'><span class="c1">// 44</span>
</span><span class='line'><span class="c1">// 45</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://is.gd/zl076C">playpen</a></p>

<p>Since rust will not allow to provide the implementation of a trait for
a type where both the trait and the type were defined in the external
crate, we need to create a tuple struct (newtype) for the array.</p>

<p>Overall, this implementation looks similar to the previous, but there are
nuances I&rsquo;d like to point out.</p>

<p><code>Line 18:</code> Note that the implementation signature adds new <code>T</code> type parameter,
which is the type of the array. It can be anything that implements
<code>Default</code>+<code>Copy</code>+<code>Encodable&lt;S, E&gt;</code> traits.
<code>Default</code> is to be able to fill array with default values (line 24).
<code>Copy</code> is to be able to copy the default values
into the new array, while the <code>Decodable&lt;S, E&gt;</code> is to be able to decode
the array elements from JSON.</p>

<p><code>Lines 22-24:</code> Here I&rsquo;m checking if the array we&rsquo;re about to decode contains
exactly the number of elements we expect. If not, I exit early with an
error.</p>

<p><code>Lines 26-28:</code> Here I&rsquo;m iterating the array, obtaining mutable
references to its elements and filling them from JSON, using
<code>decoder::read_seq_elt</code>.</p>

<p><code>Line 29:</code> Here I&rsquo;m returning the result wrapped in <code>Buffer</code> newtype.</p>

<h3>deriving(Decodable)</h3>

<p>As in part 1, let&rsquo;s look at the expanded implementation of the
<code>#[deriving(Decodable)]</code> attribute.
Let&rsquo;s use the <code>Person</code> struct example again
and compile it with <code>--pretty expanded</code> flag:</p>

<p><code>rustc app.rs --pretty expanded</code></p>

<p>The output:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='rust'><span class='line'><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="n">feature</span><span class="p">(</span><span class="n">phase</span><span class="p">)]</span>
</span><span class='line'><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="n">no_std</span><span class="p">]</span>
</span><span class='line'><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="n">feature</span><span class="p">(</span><span class="n">globs</span><span class="p">)]</span>
</span><span class='line'><span class="cp">#[phase(plugin, link)]</span>
</span><span class='line'><span class="n">extern</span> <span class="n">crate</span> <span class="n">std</span> <span class="o">=</span> <span class="s">&quot;std&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">extern</span> <span class="n">crate</span> <span class="n">rt</span> <span class="o">=</span> <span class="s">&quot;native&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">extern</span> <span class="n">crate</span> <span class="n">serialize</span><span class="p">;</span>
</span><span class='line'><span class="cp">#[prelude_import]</span>
</span><span class='line'><span class="k">use</span> <span class="n">std</span><span class="o">::</span><span class="n">prelude</span><span class="o">::*</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="n">serialize</span><span class="o">::</span><span class="p">{</span><span class="n">Decodable</span><span class="p">};</span>
</span><span class='line'><span class="n">struct</span> <span class="n">Person</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">name</span><span class="o">:</span> <span class="n">String</span><span class="p">,</span>
</span><span class='line'>    <span class="n">age</span><span class="o">:</span> <span class="k">int</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="cp">#[automatically_derived]</span>
</span><span class='line'><span class="k">impl</span> <span class="o">&lt;</span><span class="n">__D</span><span class="o">:</span> <span class="o">::</span><span class="n">serialize</span><span class="o">::</span><span class="n">Decoder</span><span class="o">&lt;</span><span class="n">__E</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">__E</span><span class="o">&gt;</span> <span class="o">::</span><span class="n">serialize</span><span class="o">::</span><span class="n">Decodable</span><span class="o">&lt;</span><span class="n">__D</span><span class="p">,</span> <span class="n">__E</span><span class="o">&gt;</span>
</span><span class='line'>     <span class="k">for</span> <span class="n">Person</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">fn</span> <span class="n">decode</span><span class="p">(</span><span class="n">__arg_0</span><span class="o">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="n">__D</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">result</span><span class="o">::</span><span class="n">Result</span><span class="o">&lt;</span><span class="n">Person</span><span class="p">,</span> <span class="n">__E</span><span class="o">&gt;</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">__arg_0</span><span class="p">.</span><span class="n">read_struct</span><span class="p">(</span><span class="s">&quot;Person&quot;</span><span class="p">,</span> <span class="m">2</span><span class="k">u</span><span class="p">,</span>
</span><span class='line'>                            <span class="n">ref</span> <span class="o">|</span><span class="n">_d</span><span class="o">|</span>
</span><span class='line'>        <span class="o">::</span><span class="n">std</span><span class="o">::</span><span class="n">result</span><span class="o">::</span><span class="n">Ok</span><span class="p">(</span><span class="n">Person</span><span class="p">{</span><span class="n">name</span><span class="o">:</span>
</span><span class='line'>           <span class="n">match</span> <span class="n">_d</span><span class="p">.</span><span class="n">read_struct_field</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span>
</span><span class='line'>                                      <span class="m">0</span><span class="k">u</span><span class="p">,</span>
</span><span class='line'>                                      <span class="n">ref</span>
</span><span class='line'>                                          <span class="o">|</span><span class="n">_d</span><span class="o">|</span>
</span><span class='line'>                                          <span class="o">::</span><span class="n">serialize</span><span class="o">::</span><span class="n">Decodable</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">_d</span><span class="p">))</span>
</span><span class='line'>               <span class="p">{</span>
</span><span class='line'>               <span class="n">Ok</span><span class="p">(</span><span class="n">__try_var</span><span class="p">)</span>
</span><span class='line'>               <span class="o">=&gt;</span> <span class="n">__try_var</span><span class="p">,</span>
</span><span class='line'>               <span class="n">Err</span><span class="p">(</span><span class="n">__try_var</span><span class="p">)</span>
</span><span class='line'>               <span class="o">=&gt;</span>
</span><span class='line'>               <span class="n">return</span> <span class="n">Err</span><span class="p">(</span><span class="n">__try_var</span><span class="p">),</span>
</span><span class='line'>           <span class="p">},</span>
</span><span class='line'>       <span class="n">age</span><span class="o">:</span>
</span><span class='line'>           <span class="n">match</span> <span class="n">_d</span><span class="p">.</span><span class="n">read_struct_field</span><span class="p">(</span><span class="s">&quot;age&quot;</span><span class="p">,</span>
</span><span class='line'>                                      <span class="m">1</span><span class="k">u</span><span class="p">,</span>
</span><span class='line'>                                      <span class="n">ref</span>
</span><span class='line'>                                          <span class="o">|</span><span class="n">_d</span><span class="o">|</span>
</span><span class='line'>                                          <span class="o">::</span><span class="n">serialize</span><span class="o">::</span><span class="n">Decodable</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">_d</span><span class="p">))</span>
</span><span class='line'>               <span class="p">{</span>
</span><span class='line'>               <span class="n">Ok</span><span class="p">(</span><span class="n">__try_var</span><span class="p">)</span>
</span><span class='line'>               <span class="o">=&gt;</span> <span class="n">__try_var</span><span class="p">,</span>
</span><span class='line'>               <span class="n">Err</span><span class="p">(</span><span class="n">__try_var</span><span class="p">)</span>
</span><span class='line'>               <span class="o">=&gt;</span>
</span><span class='line'>               <span class="n">return</span> <span class="n">Err</span><span class="p">(</span><span class="n">__try_var</span><span class="p">),</span>
</span><span class='line'>           <span class="p">},}))</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The output is very similar to the manual deserialization code we
saw earlier, except that compiler further expanded the <code>try!</code> macros into <code>Err</code> and
<code>Ok</code> branches.</p>

<h3>Further reading</h3>

<p>There is a convenience <code>ToJson</code>
<a href="https://github.com/rust-lang/rust/blob/5fb2dfaa200f2cb32e77c54ae8a5e0f4823b65c8/src/libserialize/json.rs#L2222">trait</a> that allows implementors to quickly convert itself into JSON using
intermediate <a href="https://github.com/rust-lang/rust/blob/5fb2dfaa200f2cb32e77c54ae8a5e0f4823b65c8/src/libserialize/json.rs#L211">Json enum</a> representation, but I recommend using it only for small and relatively simple data structures.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">valve</span></span>

      








  


<time datetime="2014-08-26T09:09:00+04:00" pubdate data-updated="true">Aug 26<span>th</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/json/'>json</a>, <a class='category' href='/blog/categories/rust/'>rust</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://valve.github.io/blog/2014/08/26/json-serialization-in-rust-part-2/" data-via="" data-counturl="http://valve.github.io/blog/2014/08/26/json-serialization-in-rust-part-2/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/08/25/json-serialization-in-rust-part-1/" title="Previous Post: JSON serialization in Rust, part 1">&laquo; JSON serialization in Rust, part 1</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/08/26/json-serialization-in-rust-part-2/">JSON Serialization in Rust, Part 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/25/json-serialization-in-rust-part-1/">JSON Serialization in Rust, Part 1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/04/from-object-to-functional-immutability/">Immutability in Ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/22/rails-developer-guide-to-full-text-search-with-solr/">Introduction to Full Text Search for Rails Developers</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/26/constant-resolution-in-ruby/">Constant Resolution in Ruby</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/valve">@valve</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'valve',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - valve -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'iamvalentin';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://valve.github.io/blog/2014/08/26/json-serialization-in-rust-part-2/';
        var disqus_url = 'http://valve.github.io/blog/2014/08/26/json-serialization-in-rust-part-2/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
